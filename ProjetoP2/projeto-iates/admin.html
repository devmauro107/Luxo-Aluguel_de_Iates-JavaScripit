<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Admin - Login</title>
    <link rel="stylesheet" href="css/default.css" />
</head>
<body>
    <h2>Área Administrativa</h2>

<form id="loginForm" novalidate>
    <div>
        <label for="email">E-mail:</label>
            <input
                type="email"
                id="email"
                name="email"
                autocomplete="username"
                required
                autofocus
            />
    </div>
    <div>
        <label for="senha">Senha:</label>
            <input
                type="password"
                id="senha"
                name="senha"
                autocomplete="current-password"
                required
            />
    </div>

    <div
        id="loginFeedback"
        role="status"
        aria-live="polite"
        style="color: #a00; margin: 8px 0"
    ></div>

    <button type="submit" id="loginBtn">Entrar</button>
</form>

<script src="js/jquery-3.6.4.min.js"></script>
<script src="js/api.js"></script>

<script>
    $(document).ready(function () {
        $("#loginForm").on("submit", async function (e) {
            e.preventDefault();

            var $btn = $("#loginBtn");
            var $feedback = $("#loginFeedback");
                $feedback.text("");

            var email = $("#email").val().trim();
            var senha = $("#senha").val().trim();

        if (!email) {
            $feedback.text("Preencha o e-mail.");
                $("#email").focus();
                    return;
        }
        if (!senha) {
            $feedback.text("Preencha a senha.");
                $("#senha").focus();
                    return;
        }

        var objLoginSenha = { email: email, senha: senha };

            $btn.prop("disabled", true).text("Enviando...");

        try {
            var resultado = await validarUsuario(objLoginSenha);

            var autenticado = false;
                if (resultado === true || resultado === "true") autenticado = true;

                else if (resultado && typeof resultado === "object") {

                if (
                    resultado.valid === true ||
                    resultado.autenticado === true ||
                    resultado.auth === true
                    )
                    autenticado = true;
                else if (resultado.token) autenticado = true;
            }

            if (autenticado) {
                window.location.href = "mensagens.html";
            } else {
                $feedback.text("E-mail ou senha inválidos.");
                    $btn.prop("disabled", false).text("Entrar");
            $("#email").focus();
            }
        } catch (err) {
            console.error(err);
                $feedback.text("Erro na autenticação. Tente novamente.");
                    $btn.prop("disabled", false).text("Entrar");
                    }
        });
    });
</script>

</body>
</html>
